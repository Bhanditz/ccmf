var ccmf=ccmf||{};ccmf.namespace=function(a){a=a.split(".");var f=ccmf;"ccmf"===a[0]&&(a=a.slice(1));for(var b=0;b<a.length;b+=1)"undefined"===f[a[b]]&&(f[a[b]]={}),f=f[a[b]];return f};ccmf.namespace("ccmf.Data");ccmf.Data=function(){};ccmf.Data.create=function(){return new ccmf.Data};
ccmf.Data.prototype={accessFromLocalhost:!1,rootRef:null,endpoint:"https://ccmf.firebaseio.com",init:function(){this.rootRef=new Firebase(this.endpoint);"localhost"==this.domain()?this.accessFromLocalhost=!0:this.accessFromLocalhost=!1},domain:function(){return window.location.host},pathURL:function(){return btoa(window.location.pathname)},text:function(a,f){this.init();var b=this.rootRef.child("text").child("domains").child(this.domain()).child(this.pathURL()),k=f.length;switch(a){case "w":for(var l=
0;l<k;l++)for(var m=b.child(l),n=0;n<f[l].length;n++)m.push({signature:f[l][n]})}},image:function(a,f){this.rootRef.child("image")}};var Sha1={hash:function(a,f){("undefined"==typeof f||f)&&(a=Utf8.encode(a));var b=[1518500249,1859775393,2400959708,3395469782];a+=String.fromCharCode(128);for(var k=Math.ceil((a.length/4+2)/16),l=Array(k),m=0;m<k;m++){l[m]=Array(16);for(var n=0;16>n;n++)l[m][n]=a.charCodeAt(64*m+4*n)<<24|a.charCodeAt(64*m+4*n+1)<<16|a.charCodeAt(64*m+4*n+2)<<8|a.charCodeAt(64*m+4*n+3)}l[k-1][14]=8*(a.length-1)/Math.pow(2,32);l[k-1][14]=Math.floor(l[k-1][14]);l[k-1][15]=8*(a.length-1)&4294967295;for(var n=1732584193,
h=4023233417,r=2562383102,q=271733878,t=3285377520,s=Array(80),d,c,e,g,u,m=0;m<k;m++){for(var p=0;16>p;p++)s[p]=l[m][p];for(p=16;80>p;p++)s[p]=Sha1.ROTL(s[p-3]^s[p-8]^s[p-14]^s[p-16],1);d=n;c=h;e=r;g=q;u=t;for(p=0;80>p;p++){var v=Math.floor(p/20),v=Sha1.ROTL(d,5)+Sha1.f(v,c,e,g)+u+b[v]+s[p]&4294967295;u=g;g=e;e=Sha1.ROTL(c,30);c=d;d=v}n=n+d&4294967295;h=h+c&4294967295;r=r+e&4294967295;q=q+g&4294967295;t=t+u&4294967295}return Sha1.toHexStr(n)+Sha1.toHexStr(h)+Sha1.toHexStr(r)+Sha1.toHexStr(q)+Sha1.toHexStr(t)},
f:function(a,f,b,k){switch(a){case 0:return f&b^~f&k;case 1:return f^b^k;case 2:return f&b^f&k^b&k;case 3:return f^b^k}},ROTL:function(a,f){return a<<f|a>>>32-f},toHexStr:function(a){for(var f="",b,k=7;0<=k;k--)b=a>>>4*k&15,f+=b.toString(16);return f}},Utf8={encode:function(a){a=a.replace(/[\u0080-\u07ff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(192|a>>6,128|a&63)});return a=a.replace(/[\u0800-\uffff]/g,function(a){a=a.charCodeAt(0);return String.fromCharCode(224|a>>12,128|a>>6&
63,128|a&63)})},decode:function(a){a=a.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&15)<<12|(a.charCodeAt(1)&63)<<6|a.charCodeAt(2)&63;return String.fromCharCode(a)});return a=a.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(a){a=(a.charCodeAt(0)&31)<<6|a.charCodeAt(1)&63;return String.fromCharCode(a)})}};ccmf.namespace("ccmf.Text");ccmf.Text=function(){};ccmf.Text.create=function(){return new ccmf.Text};
ccmf.Text.prototype={stopWords:"to that a for the that have it is".split(" "),alphabets:"abcdefghijklmnopqrstuvwxyz",isStopWord:function(a){for(var f=0;f<this.stopWords.length;f++)if(a.toLowerCase()==this.stopWords[f])return!0;return!1},removeStopWords:function(a){a=a.split(" ");for(var f=0;f<a.length;f++)this.isStopWord(a[f])&&a.splice(f,1);return a.join(" ")},fixedShinglesWithoutWS:function(a,f){a=a.replace(/\W/g,"");for(var b=a.replace(/ /g,""),k=[],l=0;l<b.length;l++)l+f-1<b.length&&k.push(b.substr(l,
f));return k},removedStopWordShingles:function(a,f){return this.fixedShinglesWithoutWS(this.removeStopWords(a),f)},stopMoreShingles:function(a){a=a.replace(/\W/g,"");a=a.split(" ");for(var f=[],b=0;b<a.length;b++)this.isStopWord(a[b])&&(b==a.length-1?f.push(a[b]):b+1==a.length-1?f.push(a[b]+" "+a[b+1]):f.push(a[b]+" "+a[b+1]+" "+a[b+2]));return f},shinglesFingerprintConv:function(a){for(var f=[],b=0;b<a.length;b++){var k=this.MD5(a[b]).substr(0,8),k=parseInt(k,16);f.push(k)}return f},MD5:function(a){function f(a,
b){var f,d,c,e,g;c=a&2147483648;e=b&2147483648;f=a&1073741824;d=b&1073741824;g=(a&1073741823)+(b&1073741823);return f&d?g^2147483648^c^e:f|d?g&1073741824?g^3221225472^c^e:g^1073741824^c^e:g^c^e}function b(a,b,g,c,e,d,h){a=f(a,f(f(b&g|~b&c,e),h));return f(a<<d|a>>>32-d,b)}function k(a,b,g,c,e,d,h){a=f(a,f(f(b&c|g&~c,e),h));return f(a<<d|a>>>32-d,b)}function l(a,b,c,g,d,e,h){a=f(a,f(f(b^c^g,d),h));return f(a<<e|a>>>32-e,b)}function m(a,b,c,e,g,d,h){a=f(a,f(f(c^(b|~e),g),h));return f(a<<d|a>>>32-d,b)}
function n(a){var b="",d="",c;for(c=0;3>=c;c++)d=a>>>8*c&255,d="0"+d.toString(16),b+=d.substr(d.length-2,2);return b}var h=[],r,q,t,s,d,c,e,g;a=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",d=0;d<a.length;d++){var c=a.charCodeAt(d);128>c?b+=String.fromCharCode(c):(127<c&&2048>c?b+=String.fromCharCode(c>>6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),b+=String.fromCharCode(c&63|128))}return b}(a);h=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),
e=Array(d-1),g=0,f=0;f<c;)b=(f-f%4)/4,g=8*(f%4),e[b]|=a.charCodeAt(f)<<g,f++;b=(f-f%4)/4;e[b]|=128<<8*(f%4);e[d-2]=c<<3;e[d-1]=c>>>29;return e}(a);d=1732584193;c=4023233417;e=2562383102;g=271733878;for(a=0;a<h.length;a+=16)r=d,q=c,t=e,s=g,d=b(d,c,e,g,h[a+0],7,3614090360),g=b(g,d,c,e,h[a+1],12,3905402710),e=b(e,g,d,c,h[a+2],17,606105819),c=b(c,e,g,d,h[a+3],22,3250441966),d=b(d,c,e,g,h[a+4],7,4118548399),g=b(g,d,c,e,h[a+5],12,1200080426),e=b(e,g,d,c,h[a+6],17,2821735955),c=b(c,e,g,d,h[a+7],22,4249261313),
d=b(d,c,e,g,h[a+8],7,1770035416),g=b(g,d,c,e,h[a+9],12,2336552879),e=b(e,g,d,c,h[a+10],17,4294925233),c=b(c,e,g,d,h[a+11],22,2304563134),d=b(d,c,e,g,h[a+12],7,1804603682),g=b(g,d,c,e,h[a+13],12,4254626195),e=b(e,g,d,c,h[a+14],17,2792965006),c=b(c,e,g,d,h[a+15],22,1236535329),d=k(d,c,e,g,h[a+1],5,4129170786),g=k(g,d,c,e,h[a+6],9,3225465664),e=k(e,g,d,c,h[a+11],14,643717713),c=k(c,e,g,d,h[a+0],20,3921069994),d=k(d,c,e,g,h[a+5],5,3593408605),g=k(g,d,c,e,h[a+10],9,38016083),e=k(e,g,d,c,h[a+15],14,3634488961),
c=k(c,e,g,d,h[a+4],20,3889429448),d=k(d,c,e,g,h[a+9],5,568446438),g=k(g,d,c,e,h[a+14],9,3275163606),e=k(e,g,d,c,h[a+3],14,4107603335),c=k(c,e,g,d,h[a+8],20,1163531501),d=k(d,c,e,g,h[a+13],5,2850285829),g=k(g,d,c,e,h[a+2],9,4243563512),e=k(e,g,d,c,h[a+7],14,1735328473),c=k(c,e,g,d,h[a+12],20,2368359562),d=l(d,c,e,g,h[a+5],4,4294588738),g=l(g,d,c,e,h[a+8],11,2272392833),e=l(e,g,d,c,h[a+11],16,1839030562),c=l(c,e,g,d,h[a+14],23,4259657740),d=l(d,c,e,g,h[a+1],4,2763975236),g=l(g,d,c,e,h[a+4],11,1272893353),
e=l(e,g,d,c,h[a+7],16,4139469664),c=l(c,e,g,d,h[a+10],23,3200236656),d=l(d,c,e,g,h[a+13],4,681279174),g=l(g,d,c,e,h[a+0],11,3936430074),e=l(e,g,d,c,h[a+3],16,3572445317),c=l(c,e,g,d,h[a+6],23,76029189),d=l(d,c,e,g,h[a+9],4,3654602809),g=l(g,d,c,e,h[a+12],11,3873151461),e=l(e,g,d,c,h[a+15],16,530742520),c=l(c,e,g,d,h[a+2],23,3299628645),d=m(d,c,e,g,h[a+0],6,4096336452),g=m(g,d,c,e,h[a+7],10,1126891415),e=m(e,g,d,c,h[a+14],15,2878612391),c=m(c,e,g,d,h[a+5],21,4237533241),d=m(d,c,e,g,h[a+12],6,1700485571),
g=m(g,d,c,e,h[a+3],10,2399980690),e=m(e,g,d,c,h[a+10],15,4293915773),c=m(c,e,g,d,h[a+1],21,2240044497),d=m(d,c,e,g,h[a+8],6,1873313359),g=m(g,d,c,e,h[a+15],10,4264355552),e=m(e,g,d,c,h[a+6],15,2734768916),c=m(c,e,g,d,h[a+13],21,1309151649),d=m(d,c,e,g,h[a+4],6,4149444226),g=m(g,d,c,e,h[a+11],10,3174756917),e=m(e,g,d,c,h[a+2],15,718787259),c=m(c,e,g,d,h[a+9],21,3951481745),d=f(d,r),c=f(c,q),e=f(e,t),g=f(g,s);return(n(d)+n(c)+n(e)+n(g)).toLowerCase()},minHashSignaturesGen:function(a,f){for(var b=[],
k=[],l=0;l<a.length;l++){b=b.concat(a[l]);k[l]=[];for(var m=0;m<f;m++)k[l].push(Infinity)}for(var l=this.hashFnGen(f,b.length),m=[],n=null,h=0;h<b.length;h++){for(var r=b[h],m=[],n=0;n<l.length;n++)m.push(l[n](r));for(n=0;n<a.length;n++)if(-1<a[n].indexOf(r))for(var q=0;q<k[n].length;q++)m[q]<k[n][q]&&(k[n][q]=m[q])}ccmf.Data.create().text("w",k);return k},hashFnGen:function(a,f){for(var b=[],k=0;k<a;k++)b.push(function(a){var b=Math.floor(Math.random()*f)+1,k=Math.floor(Math.random()*f)+1;return(b*
a+k)%f});return b},compareTwoSignaturesPractical:function(a,f){var b=[];b[0]=a;b[1]=f;for(var b=this.minHashSignaturesGen(b,100),k=0,l=0;100>l;l++)b[0][l]==b[1][l]&&k++;return 100*(k/100)},LSH:function(a,f){for(var b=Array(f),k=Math.floor(a[0].length/f),l=0;l<f;l++){b[l]=Array(3571);for(var m=0;3571>m;m++)b[l][m]=[];for(m=0;m<a.length;m++){for(var n=[],h=l*(k-1)+l;h<l*(k-1)+l+k;h++)n.push(a[m][h]);n=this.LSHHashingFn(n,3571);b[l][n].push(m)}}k=0;m=[];for(l=0;l<f;l++)for(n=0;n<b[l].length;n++)if("undefined"!=
typeof b[l][n]&&1<b[l][n].length){for(var h=b[l][n],r=this.k_combinations(h,2);0<r.length;){var q=r.pop();this.candidateExist(m,h)||m.push(q)}k++}return m},LSHHashingFn:function(a,f){for(var b=0,k=0;k<a.length;k++)b+=Math.pow(a[k],k);return b%f},k_combinations:function(a,f){var b,k,l,m,n;if(f>a.length||0>=f)return[];if(f==a.length)return[a];if(1==f){l=[];for(b=0;b<a.length;b++)l.push([a[b]]);return l}l=[];for(b=0;b<a.length-f+1;b++)for(m=a.slice(b,b+1),n=this.k_combinations(a.slice(b+1),f-1),k=0;k<
n.length;k++)l.push(m.concat(n[k]));return l},candidateExist:function(a,f){for(var b=0;b<a.length;b++)if(arr=a[b],arr[0]==f[0]&&arr[1]==f[1])return!0;return!1}};
